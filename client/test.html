<script>
    const rejects = [];
    const resolves = [];

    function *waitCards(player) {
        const handler = message => {
            resolves.pop()(message);
            rejects.pop();
        }

        player.addEventListener('message', handler);

        try {
            while (true) {
                yield new Promise((resolve, reject) => {
                    resolves.push(resolve);
                    rejects.push(reject);
                });
            }
        } catch(e) {
            player.removeEventListener('message', handler);
            rejects.forEach(rej => rej('cancelled'));
            //yield '12';
        }
    } 

    ee = new EventTarget();
    generator = waitCards(ee); 

    generator.next().value.catch(() => 'ничего');

    generator.throw();
    //generator.throw();

    /*(async function () {
        for (let card of generator) {
            card = await card.catch(e => console.log('e',e));
            const a = generator.throw();
            console.log('gen', card);
        }
    })().catch(e => {
        debugger
    });*/
    
    try {
        
    } catch(e) {
        debugger
    }
    
    // 
    //     for await (let val of generator) 
    //         console.log('gen', val);
    // })();

    //ee.dispatchEvent(new Event("message"));
    //generator.throw()

</script>