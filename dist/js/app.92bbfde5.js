(()=>{"use strict";var e={44:(e,s,t)=>{var a=t(963),n=t(252);function r(e,s,t,a,r,o){const i=(0,n.up)("modal-auth"),l=(0,n.up)("room-list"),d=(0,n.up)("game");return(0,n.wg)(),(0,n.iD)(n.HY,null,[r.socket&&!r.userName?((0,n.wg)(),(0,n.j4)(i,{key:0,socket:r.socket,modelValue:r.userName,"onUpdate:modelValue":s[0]||(s[0]=e=>r.userName=e)},null,8,["socket","modelValue"])):(0,n.kq)("",!0),r.userName&&!r.room?((0,n.wg)(),(0,n.j4)(l,{key:1,socket:r.socket,modelValue:r.room,"onUpdate:modelValue":s[1]||(s[1]=e=>r.room=e)},null,8,["socket","modelValue"])):(0,n.kq)("",!0),r.room?((0,n.wg)(),(0,n.j4)(d,{key:2,socket:r.socket,username:r.userName,modelValue:r.room,"onUpdate:modelValue":s[2]||(s[2]=e=>r.room=e)},null,8,["socket","username","modelValue"])):(0,n.kq)("",!0)],64)}var o=t(577);const i=e=>((0,n.dD)("data-v-30839605"),e=e(),(0,n.Cn)(),e),l={class:"authWrapper"},d={class:"content"},u=i((()=>(0,n._)("h1",null,"Введите своё имя",-1))),c=i((()=>(0,n._)("br",null,null,-1))),m={class:"information"};function p(e,s,t,r,i,p){return(0,n.wg)(),(0,n.iD)("div",l,[(0,n._)("div",d,[u,(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=e=>i.userName=e),placeholder:"Введите имя"},null,512),[[a.nr,i.userName]]),c,(0,n._)("button",{onClick:s[1]||(s[1]=e=>p.auth(i.userName))},"Войти"),(0,n._)("p",m,(0,o.zw)(i.info),1)])])}const h={data(){return{userName:"",info:""}},props:{modelValue:{type:String},socket:{type:WebSocket}},methods:{handler(e){const s=JSON.parse(e.data);"auth"===s.event&&"ok"===s.data?(this.$emit("update:modelValue",this.userName),localStorage.setItem("username",this.userName)):"error"===s.event&&(this.info,s.data)},auth(e){e&&this.socket.send(JSON.stringify({event:"auth",username:e}))}},async mounted(){this.socket.addEventListener("message",this.handler);const e=localStorage.getItem("username");e&&this.auth(this.userName=e)},unmounted(){this.socket.removeEventListener("message",this.handler)}};var k=t(744);const w=(0,k.Z)(h,[["render",p],["__scopeId","data-v-30839605"]]),f=w,v={class:"wrapper"},g=(0,n._)("h1",null,"Cписок комнат",-1),y={class:"createRoomWrapper"},_=(0,n._)("h2",null,"Создать комнату",-1),b=["onClick"];function U(e,s,t,r,i,l){return(0,n.wg)(),(0,n.iD)("div",v,[g,(0,n._)("div",y,[_,(0,n._)("label",null,[(0,n.Uk)("Пароль: "),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>i.password=e),type:"text",placeholder:"необязательно"},null,512),[[a.nr,i.password]])]),(0,n._)("button",{onClick:s[1]||(s[1]=e=>l.createRoom())},"Создать")]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.rooms,((e,s)=>((0,n.wg)(),(0,n.iD)("div",{key:s,class:(0,o.C_)(["room",{red:e.started||6===e.capacity}])},[(0,n._)("span",null,"Комната игрока: "+(0,o.zw)(e.user),1),(0,n.Uk)(" | "),(0,n._)("span",null,"Свободных мест: "+(0,o.zw)(6-e.capacity),1),(0,n.Uk)(" | "),(0,n._)("span",null,"Пароль: "+(0,o.zw)(e.password?"есть":"нет"),1),(0,n.Uk)(" | "),(0,n._)("button",{onClick:s=>l.join(e)},"Войти",8,b)],2)))),128))])}const N={data(){return{rooms:{},room:null,password:""}},props:{modelValue:{type:Object},socket:{type:WebSocket}},methods:{createRoom(){this.socket.send(JSON.stringify({event:"createRoom",password:this.password}))},join(e){const s={event:"join",roomId:e.id};if(e.password){let e=prompt("Введите пароль");Object.assign(s,{password:e})}this.socket.send(JSON.stringify(s))},handler(e){const s=JSON.parse(e.data);"createRoom"===s.event?this.rooms[s.data.id]=s.data:"joinRoom"===s.event?this.$emit("update:modelValue",s.data):"error"===s.event&&alert(s.data)}},async mounted(){this.socket.addEventListener("message",this.handler),this.socket.send(JSON.stringify({event:"roomList"}))},unmounted(){this.rooms=null,this.socket.removeEventListener("message",this.handler)}},O=(0,k.Z)(N,[["render",U]]),S=O,C=e=>((0,n.dD)("data-v-64ed9067"),e=e(),(0,n.Cn)(),e),z={class:"gameWrapper"},D={class:"circleOfPlayers"},V={class:"cards"},j=["onClick"],I={class:"nameUp"},J=C((()=>(0,n._)("br",null,null,-1))),L={class:"suit"},x={class:"nameDown"},H=C((()=>(0,n._)("br",null,null,-1))),R={class:"suit"},Y={class:"fields"},E={class:"deck"},W={class:"trump"},q={class:"cards"},P={class:"nameUp"},F=C((()=>(0,n._)("br",null,null,-1))),K={class:"suit"},$={class:"nameDown"},T=C((()=>(0,n._)("br",null,null,-1))),Z={class:"suit"},G={class:"desk"},A={class:"cards"},B={class:"nameUp"},M=C((()=>(0,n._)("br",null,null,-1))),Q={class:"suit"},X={class:"nameDown"},ee=C((()=>(0,n._)("br",null,null,-1))),se={class:"suit"},te=C((()=>(0,n._)("div",{class:"dump"},null,-1))),ae={class:"info"};function ne(e,s,t,r,i,l){return(0,n.wg)(),(0,n.iD)("div",z,[(0,n._)("button",{class:"buttonLeave",onClick:s[0]||(s[0]=(...e)=>l.leaveGame&&l.leaveGame(...e))},"Выйти"),(0,n._)("div",D,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.players,((e,t)=>((0,n.wg)(),(0,n.iD)("span",{class:(0,o.C_)(["playerField",{me:e.me}])},[e.me?(0,n.wy)(((0,n.wg)(),(0,n.iD)("button",{key:0,onClick:s[1]||(s[1]=(...e)=>l.action&&l.action(...e)),class:"action"},(0,o.zw)(i.started?e.defence?"Беру":"Пас":"Готов"),513)),[[a.F8,!i.started||e.ready]]):(0,n.kq)("",!0),(0,n._)("p",{class:(0,o.C_)(["userName",{ready:e.ready}])},(0,o.zw)(e.name)+" "+(0,o.zw)(e.defence?"🛡":""),3),(0,n._)("p",V,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e[e.me?"sortedCards":"cards"],(s=>((0,n.wg)(),(0,n.iD)("span",{onClick:t=>e.me?l.step(s):null},[(0,n._)("span",{class:(0,o.C_)(["card",{hidden:!s.suit,red:"♥"===s.suit||"♦"===s.suit}])},[s.suit?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",I,[(0,n.Uk)((0,o.zw)(s.name)+" ",1),J,(0,n.Uk)(),(0,n._)("span",L,(0,o.zw)(s.suit),1)]),(0,n._)("span",x,[(0,n.Uk)((0,o.zw)(s.name),1),H,(0,n.Uk)(),(0,n._)("span",R,(0,o.zw)(s.suit),1)])],64)):(0,n.kq)("",!0)],2)],8,j)))),256))])],2)))),256))]),(0,n._)("div",Y,[(0,n._)("div",E,[(0,n.wy)((0,n._)("div",{class:"cardsRest"},(0,o.zw)(i.deck.length),513),[[a.F8,i.deck.length]]),(0,n._)("div",W,(0,o.zw)(i.trump),1),(0,n._)("div",q,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.deck,(e=>((0,n.wg)(),(0,n.iD)("span",null,[(0,n._)("span",{class:(0,o.C_)(["card",{red:"♥"===e.suit||"♦"===e.suit}])},[e.suit?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",P,[(0,n.Uk)((0,o.zw)(e.name)+" ",1),F,(0,n.Uk)(),(0,n._)("span",K,(0,o.zw)(e.suit),1)]),(0,n._)("span",$,[(0,n.Uk)((0,o.zw)(e.name),1),T,(0,n.Uk)(),(0,n._)("span",Z,(0,o.zw)(e.suit),1)])],64)):(0,n.kq)("",!0)],2)])))),256))])]),(0,n._)("div",G,[(0,n._)("div",A,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.desk,(e=>((0,n.wg)(),(0,n.iD)("span",null,[(0,n._)("span",{class:(0,o.C_)(["card",{red:"♥"===e.suit||"♦"===e.suit}])},[(0,n._)("span",B,[(0,n.Uk)((0,o.zw)(e.name)+" ",1),M,(0,n.Uk)(),(0,n._)("span",Q,(0,o.zw)(e.suit),1)]),(0,n._)("span",X,[(0,n.Uk)((0,o.zw)(e.name),1),ee,(0,n.Uk)(),(0,n._)("span",se,(0,o.zw)(e.suit),1)])],2)])))),256))])]),te]),(0,n._)("div",ae,[(0,n._)("p",null,(0,o.zw)(i.info),1)])])}const re=e=>(+e||e).toString(11),oe={data(){return{users:[],deck:[],desk:[],dump:[],trump:null,started:!1,info:""}},props:{modelValue:{type:Number},username:{type:String},socket:{type:WebSocket}},methods:{leaveGame(){this.socket.send(JSON.stringify({event:"leave"})),this.$emit("update:modelValue",null)},action(){this.socket.send(JSON.stringify({event:this.started?"step":"ready"}))},step(e){this.socket.send(JSON.stringify({event:"step",card:{suit:e.suit,name:e.name}}))},showInfo(e,s=4e3){this.info=e,setTimeout((()=>this.info=""),s)},handler(e){const s=JSON.parse(e.data);if("addUser"===s.event){this.users.push(Object.assign(s.data,{cards:[]}));const e=this.users[this.users.length-1];e.name===this.username&&(e.me=!0,e.sortedCards=(0,n.Fl)((()=>e.cards.toSorted(((e,s)=>re(e.name)<re(s.name)?1:-1)).toSorted(((e,s)=>e.suit>s.suit?1:-1)).toSorted(((e,s)=>e.suit===this.trump^s.suit===this.trump?e.suit===this.trump?1:-1:0)))))}else if("remUser"===s.event)this.users.splice(this.users.findIndex((e=>e.name===s.data.name)),1);else if("addCard"===s.event){const e="player"===s.data.type?this.users.find((({name:e})=>e===s.data.name)).cards:this[s.data.type];s.data.card.suit?e.push(s.data.card):e.push(...new Array(s.data.card).fill({}))}else if("remCard"===s.event){const e="player"===s.data.type?this.users.find((({name:e})=>e===s.data.name)).cards:this[s.data.type];s.data.card.suit?e.splice(e.findIndex((({name:e,suit:t})=>e===s.data.card.name&&t===s.data.card.suit)),1):e.splice(e.length-s.data.card,s.data.card)}else if("changeStatus"===s.event){const e=this.users.find((e=>e.name===s.data.name));if(!e)return;e.ready=s.data.ready,this.started&&e.ready&&e.name===this.username&&this.showInfo("Ваш ход!")}else if("info"===s.event){if("defencePlayer"===s.data.type){const e=this.users.find((e=>e.defence));e&&(e.defence=!1);const t=this.users.find((e=>e.name===s.data.name));t.defence=!0}else if("gameStatus"===s.data.type)if(this.started=s.data.started){this.deck.length=this.desk.length=this.dump.length=0;for(let e of this.users)e.cards.length=0;this.showInfo("Игра началась!")}else this.showInfo("Игра окончена! "+(s.data.fool?s.data.fool+" проиграл!":"Ничья!"))}else"setTrump"===s.event&&(this.trump=s.data)}},computed:{players(){const e=this.users.findIndex((e=>e.name===this.username)),s=[...this.users];return s.splice(e).concat(s)}},mounted(){this.socket.addEventListener("message",this.handler)},unmounted(){this.socket.removeEventListener("message",this.handler)}},ie=(0,k.Z)(oe,[["render",ne],["__scopeId","data-v-64ed9067"]]),le=ie,de={components:{modalAuth:f,roomList:S,game:le},data(){return{userName:"",socket:null,room:null}},async mounted(){const e=new URLSearchParams(window.location.search),s=e.get("serverip")||window.location.hostname;let t=new WebSocket(`ws://${s}:5000`);try{t.onclose=e=>{console.log("Соединение закрыто")},await new Promise(((e,s)=>{t.onopen=e,t.onerror=s})),this.socket=t}catch(a){alert(`Не удалось подключиться к серверу ${t.url}`)}}},ue=(0,k.Z)(de,[["render",r]]),ce=ue,me=(0,a.ri)(ce);me.mount("#app")}},s={};function t(a){var n=s[a];if(void 0!==n)return n.exports;var r=s[a]={exports:{}};return e[a](r,r.exports,t),r.exports}t.m=e,(()=>{var e=[];t.O=(s,a,n,r)=>{if(!a){var o=1/0;for(u=0;u<e.length;u++){for(var[a,n,r]=e[u],i=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(t.O).every((e=>t.O[e](a[l])))?a.splice(l--,1):(i=!1,r<o&&(o=r));if(i){e.splice(u--,1);var d=n();void 0!==d&&(s=d)}}return s}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[a,n,r]}})(),(()=>{t.d=(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s)})(),(()=>{var e={143:0};t.O.j=s=>0===e[s];var s=(s,a)=>{var n,r,[o,i,l]=a,d=0;if(o.some((s=>0!==e[s]))){for(n in i)t.o(i,n)&&(t.m[n]=i[n]);if(l)var u=l(t)}for(s&&s(a);d<o.length;d++)r=o[d],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(u)},a=self["webpackChunkcardsonline"]=self["webpackChunkcardsonline"]||[];a.forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a))})();var a=t.O(void 0,[998],(()=>t(44)));a=t.O(a)})();
//# sourceMappingURL=app.92bbfde5.js.map